<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>修改密码</title>
    <link href="../../../css/mui.css" rel="stylesheet" />
    <link href="../../../css/layout.css" rel="stylesheet" />
    <link href="../../../css/siteDetail.css" rel="stylesheet" />
    <link href="../../../css/index.css" rel="stylesheet" />
</head>

<body>
<header class="mui-bar-nav mui-bar-transparent" >
    <a   class="mui-icon mui-icon-left-nav mui-pull-left"  onclick="APIUtils.goBeforePage()"></a>
    <h1 class="mui-title">修改密码</h1>
</header>
<div style="height:40px;"></div>
<form id="editPassword">
    <h5 class="pl10 fblue2 lineHeight34">输入旧密码<span class="fred">*</span></h5>
    <div class="mui-input-group ">
        <div class="bgblue pdlr10">
            <div class="mui-input-row">
                <input type="password" name="oldPassword" id="oldPassword" placeholder="请填写旧密码" >
            </div>
        </div>
    </div>

    <h5 class="pl10 fblue2 lineHeight34">新密码<span class="fred">*</span></h5>
    <div class="mui-input-group ">
        <div class="bgblue pdlr10">
            <div class="mui-input-row">
                <input type="password" name="newPassword" id="newPassword" placeholder="请填写新密码" >
            </div>
        </div>
    </div>

    <h5 class="pl10 fblue2 lineHeight34">确认新密码<span class="fred">*</span></h5>
    <div class="mui-input-group ">
        <div class="bgblue pdlr10">
            <div class="mui-input-row">
                <input type="password" name="renewPassword" id="renewPassword" placeholder="请重新输入新密码" >
            </div>
        </div>
    </div>

    <div class="mui-content-padded">
        <button id="searchButton" type="button" class="mui-btn mui-btn-block mybtn" onclick="editPassword()">确认提交</button>
    </div>
</form>
</body>


<script type="text/javascript" src="../../../script/api.js"></script>
<script type="text/javascript" src="../../../script/dot.min.js"></script>
<script type="text/javascript" src="../../../script/js/APIUtils.js"></script>
<script type="text/javascript" src="../../../script/js/my/accountManage/accountManage-personalInformation.js"></script>

<script>
    apiready = function () {
        $api.fixStatusBar( $api.dom('header'));
    };
    //修改密码方法
    function editPassword() {
        var oldPassword = $api.byId("oldPassword").value;
        var newPassword = $api.byId("newPassword").value;
        var renewPassword = $api.byId("renewPassword").value;
        //非空判断
        if (oldPassword == "" || oldPassword == null || oldPassword == undefined) {
            APIUtils.showToast("请输入旧密码", 2000);
            return;
        }
        if (newPassword == "" || newPassword == null || newPassword == undefined) {
            APIUtils.showToast("请输入新密码", 2000);
            return;
        }
        //新旧密码保持一致
        if (newPassword != renewPassword || renewPassword == null) {
            APIUtils.showToast("请保持新密码一致", 2000);
            return;
        }
        // //新旧密码不能相同
        // if (newPassword = oldPassword ) {
        //     APIUtils.showToast("不能和旧密码重复", 2000);
        //     return;
        // }
        //判断密码至少包含一个数字或者字母 长度大于6位小于13
        if (newPassword.length < 6) {
            APIUtils.showToast("密码长度至少为6位", 2000);
            return;
        }
        //从缓存中拿到主键id
        var id = $api.getStorage(KeyMap.CURRENT_USER)["id"];
        //提交数据json
        var editPwInfo = {id: id, oldPassword: oldPassword, newPassword: newPassword};
        APIUtils.showProgress("提示", "正在修改....");
        //修改密码方法
        personalModule.editPassword(editPwInfo, function (ret, err) {
            APIUtils.hideProgress();
            //判断请求是否错误
            if (!APIUtils.errorCatch(err)) {
                return;
            }
            APIUtils.showToast("修改成功，请重新登录", 3000);
            // 清除localStorage的所有数据
            $api.clearStorage();
            $api.byId("oldPassword").value = "";
            $api.byId("newPassword").value = "";
            $api.byId("renewPassword").value = "";
            //修改成功后跳回登录页面
            APIUtils.goToPageByWindow("login",'../../../login.html');
            // window.location.href='../../../login.html';
        })
    }

</script>
</html>