<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>选择检查项</title>
    <link href="../../../../css/mui.css" rel="stylesheet" />
    <link href="../../../../css/layout.css" rel="stylesheet" />
    <style>
        .dubellinelist li{padding: 10px;margin: 10px;border: 1px solid #2d6b91;border-radius: 5px;}
        .dubellinelist li:first-child{padding-top: 10px;}
        /*.dubellinelist li:last-child{border-bottom: 0px;padding-bottom: 2px;}*/
        .mui-checkbox{position: static;}
        .mui-checkbox input[type='checkbox'] {
            position: static;
            top: 4px;
            right: 20px;
            display: inline-block;
            width: 28px;
            height: 22px;
            border: 0;
            outline: 0 !important;
            background-color: transparent;
            -webkit-appearance: none;
        }
    </style>
</head>

<body>
<header id="header" class="mui-bar mui-bar-transparent" style="display: none;">
    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
    <h1 class="mui-title">选择检查项</h1>
</header>
<div class="dubellinelist">
    <ul id="checkProjectDetailDiv" style="margin-bottom: 42px;">
        <li style="visibility: hidden;">
            <div class="mui-col-xs-2 mui-col-sm-2 fl">
                <img src="../../../../image/hqwllogo.png" class="h-center v-center flex-col" width="90%" style="border-radius: 50%;" />
            </div>
            <div class="mui-col-xs-10 mui-col-sm-10 fl">
                <p class="f16">未建立安全责任制</p>
                <div class="mui-checkbox">
                    <input class="fr" type="checkbox" name="checkProject"/>
                </div>
            </div>
            <div class="clear"></div>
        </li>
    </ul>
</div>
<script id="checkProjectDetailDot" type="text/x-dot-template">
    {{ for(var x in it) { }}
    <li>
        <div class="mui-col-xs-2 mui-col-sm-2 fl">
            <img src="../../../../image/hqwllogo.png" class="h-center v-center flex-col" width="90%" style="border-radius: 50%;" />
        </div>
        <div class="mui-col-xs-10 mui-col-sm-10 fl" onclick="changeCheckBox('{{= x}}')">
            <p class="f16">{{= it[x].checkProjectName}}</p>
            <div class="mui-checkbox">
                <input class="fr" type="checkbox" name="checkProject" value="{{= it[x].checkProjectName}}" onclick="changeCheckBox('{{= x}}')"/>
            </div>
        </div>
        <div class="clear"></div>
    </li>
    {{ } }}
</script>
<script type="text/javascript" src="../../../../script/mui.js"></script>
<script type="text/javascript" src="../../../../script/api.js"></script>
<script type="text/javascript" src="../../../../script/dot.min.js"></script>
<script type="text/javascript" src="../../../../script/js/APIUtils.js"></script>
<script type="text/javascript" src="../../../../script/js/business/business-supervision.js"></script>
<script type="text/javascript">
    apiready = function() {
        // 初始化加载数据
        getSelectCheckProjectDetail();
    };

    /**
     * 根据父节点id加载所有子节点检查项
     */
    function getSelectCheckProjectDetail() {
        APIUtils.showProgress("提示", "正在加载中....");
        superModule.getCheckProjectDetail(api.pageParam.parentId, function(ret, err) {
            APIUtils.hideProgress();
            // 判断请求是否错误
            if (!APIUtils.errorCatch(err)) {
                return;
            }
            var interText = doT.template($api.dom("#checkProjectDetailDot").innerHTML);
            $api.dom('#checkProjectDetailDiv').innerHTML = interText(ret.data);
        });
    }

    /**
     * 选择复选框
     * @param n 检查项下标
     */
    function changeCheckBox(n) {
        // 获取所有多选框
        var boxes = document.getElementsByName("checkProject");
        // 序号转为数值下标
        var i = parseInt(n);
        boxes[i].checked = !boxes[i].checked;
    }

    /**
     * 获取所有已选框的value并跳转到新增安全整改
     */
    function finshSelect() {
        // 获取所有多选框
        var boxes = document.getElementsByName("checkProject");
        // 拿取已存放在api.pageParam里面的值
        // var selectedData = new Array();
        var selectedData = "";
        for(var i=0; i<boxes.length; i++) {
            if(boxes[i].checked) {
                if(selectedData == "")  selectedData += boxes[i].value;
                else    selectedData += ","+boxes[i].value;
            }
        }
        api.execScript({
            name: 'addRecordForm',
            frameName : 'addRecordFormBody',
            script : 'selectCheckProject("'+selectedData+'", "'+api.pageParam.f4+'");'
        });
    }
</script>
</body>

</html>