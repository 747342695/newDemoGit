<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>设备详情</title>
    <link href="../../../../css/mui.min.css" rel="stylesheet" />
    <link href="../../../../css/layout.css" rel="stylesheet" />
    <link href="../../../../css/siteDetail.css" rel="stylesheet" />
    <script type="text/javascript" src="../../../../script/dot.min.js"></script>
    <script type="text/javascript" src="../../../../script/api.js"></script>
    <script type="text/javascript" src="../../../../script/js/APIUtils.js"></script>
    <script type="text/javascript" src="../../../../script/js/business/business-supervision.js"></script>
</head>

<body>
<header class="mui-bar-nav mui-bar-transparent" style="display: none;">
    <a class="mui-icon mui-icon-left-nav mui-pull-left" onclick="APIUtils.goBeforePage()"></a>
    <h1 class="mui-title">设备详情</h1>
</header>
<!--<div style="height:44px;"></div>-->
<!--for start-->
<div class="onellinelist f15">
    <div class="topcircle">
        <div class="toplinebg">
        </div>
    </div>

    <div class="clear"></div>
    <div class="leftboder">
        <div class="inforTittle">
            <span>设备信息</span>
            <div class="clear"></div>
        </div>
        <ul>

            <li>
                <div class="mui-col-sm-5 mui-col-xs-5 fl">
                    <span class="pl10 fblue2">设备名称:</span>
                </div>
                <div class="mui-col-sm-7 mui-col-xs-7 fl" id="deviceName">

                </div>
                <div class="clear"></div>
            </li>
            <li>
                <div class="mui-col-sm-5 mui-col-xs-5 fl">
                    <span class="pl10 fblue2">设备类型:</span>
                </div>
                <div class="mui-col-sm-7 mui-col-xs-7 fl" id="deviceSubTypeText">

                </div>
                <div class="clear"></div>
            </li>
            <li>
                <div class="mui-col-sm-5 mui-col-xs-5 fl">
                    <span class="pl10 fblue2">机械区域:</span>
                </div>
                <div class="mui-col-sm-7 mui-col-xs-7 fl" id="position">

                </div>
                <div class="clear"></div>
            </li>

            <li>
                <div class="mui-col-sm-5 mui-col-xs-5 fl">
                    <span class="pl10 fblue2">备案机关:</span>
                </div>
                <div class="mui-col-sm-7 mui-col-xs-7 fl" id="openApi">

                </div>
                <div class="clear"></div>
            </li>
            <li>
                <div class="mui-col-sm-5 mui-col-xs-5 fl">
                    <span class="pl10 fblue2">备案时间:</span>
                </div>
                <div class="mui-col-sm-7 mui-col-xs-7 fl" id="entryTime">

                </div>
                <div class="clear"></div>
            </li>

            <li>
                <div class="mui-col-sm-5 mui-col-xs-5 fl">
                    <span class="pl10 fblue2">制造单位:</span>
                </div>
                <div class="mui-col-sm-7 mui-col-xs-7 fl" id="manufacturer">

                </div>
                <div class="clear"></div>
            </li>
            <li>
                <div class="mui-col-sm-5 mui-col-xs-5 fl">
                    <span class="pl10 fblue2">合格证编号:</span>
                </div>
                <div class="mui-col-sm-7 mui-col-xs-7 fl" id="f1">

                </div>
                <div class="clear"></div>
            </li>
            <li>
                <div class="mui-col-sm-5 mui-col-xs-5 fl">
                    <span class="pl10 fblue2">生产日期:</span>
                </div>
                <div class="mui-col-sm-7 mui-col-xs-7 fl" id="createOn">

                </div>
                <div class="clear"></div>
            </li>
            <li>
                <div class="mui-col-sm-5 mui-col-xs-5 fl">
                    <span class="pl10 fblue2">规格型号:</span>
                </div>
                <div class="mui-col-sm-7 mui-col-xs-7 fl" id="deviceKind">

                </div>
                <div class="clear"></div>
            </li>
            <li>
                <div class="mui-col-sm-5 mui-col-xs-5 fl">
                    <span class="pl10 fblue2">购置/租赁日期:</span>
                </div>
                <div class="mui-col-sm-7 mui-col-xs-7 fl" id="updateOn">

                </div>
                <div class="clear"></div>
            </li>
            <li>
                <div class="mui-col-sm-5 mui-col-xs-5 fl">
                    <span class="pl10 fblue2">所属项目编号:</span>
                </div>
                <div class="mui-col-sm-7 mui-col-xs-7 fl" id="f2">

                </div>
                <div class="clear"></div>
            </li>
            <li>
                <div class="mui-col-sm-5 mui-col-xs-5 fl">
                    <span class="pl10 fblue2">所属项目名称:</span>
                </div>
                <div class="mui-col-sm-7 mui-col-xs-7 fl" id="projectName">

                </div>
                <div class="clear"></div>
            </li>
            <li>
                <div class="mui-col-sm-5 mui-col-xs-5 fl">
                    <span class="pl10 fblue2">使用年限:</span>
                </div>
                <div class="mui-col-sm-7 mui-col-xs-7 fl" id="orderby">

                </div>
                <div class="clear"></div>
            </li>
            <li>
                <div class="mui-col-sm-5 mui-col-xs-5 fl">
                    <span class="pl10 fblue2">状态:</span>
                </div>
                <div class="mui-col-sm-7 mui-col-xs-7 fl" id="state">

                </div>
                <div class="clear"></div>
            </li>


            <!--<li>-->
            <!--<div class="mui-col-sm-5 mui-col-xs-5 fl">-->
            <!--<span class="pl10 fblue2">设备状态:</span>-->
            <!--</div>-->
            <!--<div class="mui-col-sm-7 mui-col-xs-7 fl" id="state">-->

            <!--</div>-->
            <!--<div class="clear"></div>-->
            <!--</li>-->


        </ul>
    </div>

</div>
<!--for end-->
<!--for start-->
<div class="onellinelist f15">
    <div class="topcircle">
        <div class="toplinebg">
        </div>
    </div>

    <div class="clear"></div>
    <div class="leftboder">
        <div class="inforTittle">
            <span>产权信息</span>
            <div class="clear"></div>
        </div>
        <ul>
            <li>
                <div class="mui-col-sm-5 mui-col-xs-5 fl">
                    <span class="pl10 fblue2">设备产权单位:</span>
                </div>
                <div class="mui-col-sm-7 mui-col-xs-7 fl" id="leasingCompany">

                </div>
                <div class="clear"></div>
            </li>
            <li>
                <div class="mui-col-sm-5 mui-col-xs-5 fl">
                    <span class="pl10 fblue2">单位地址:</span>
                </div>
                <div class="mui-col-sm-7 mui-col-xs-7 fl" id="memo">

                </div>
                <div class="clear"></div>
            </li>
            <li>
                <div class="mui-col-sm-5 mui-col-xs-5 fl">
                    <span class="pl10 fblue2">企业代表人:</span>
                </div>
                <div class="mui-col-sm-7 mui-col-xs-7 fl" id="leasingContact">

                </div>
                <div class="clear"></div>
            </li>
            <!--<li>-->
            <!--<div class="mui-col-sm-5 mui-col-xs-5 fl">-->
            <!--<span class="pl10 fblue2">设备登记状态:</span>-->
            <!--</div>-->
            <!--<div class="mui-col-sm-7 mui-col-xs-7 fl" id="deviceState">-->

            <!--</div>-->
            <!--<div class="clear"></div>-->
            <!--</li>-->
            <li>
                <div class="mui-col-sm-5 mui-col-xs-5 fl">
                    <span class="pl10 fblue2">法人电话:</span>
                </div>
                <div class="mui-col-sm-7 mui-col-xs-7 fl" id="leasingPhone">

                </div>
                <div class="clear"></div>
            </li>
            <li>
                <div class="mui-col-sm-5 mui-col-xs-5 fl">
                    <span class="pl10 fblue2">联系人:</span>
                </div>
                <div class="mui-col-sm-7 mui-col-xs-7 fl" id="responsiblePersonName">

                </div>
                <div class="clear"></div>
            </li>
            <li>
                <div class="mui-col-sm-5 mui-col-xs-5 fl">
                    <span class="pl10 fblue2">联系电话:</span>
                </div>
                <div class="mui-col-sm-7 mui-col-xs-7 fl" id="responsiblePersonPhone">

                </div>
                <div class="clear"></div>
            </li>
        </ul>
    </div>

</div>
</div>


<div class="onellinelist f15" style="padding-bottom: 45px;">
    <div class="topcircle">
        <div class="toplinebg">
        </div>
    </div>
    <div class="leftboder">
        <div class="inforTittle">
            <span>附件信息</span>
            <div class="clear"></div>
        </div>
        <ul id="imgDiv">
        </ul>
    </div>
    <!--<div class="clear"></div>-->
</div>
<script id="imgDot" type="text/x-dot-template">
    {{ for(var x in it) { }}
    <li class="mui-col-xs-4 mui-col-sm-4 fl">
        <img name="imgs" src="{{= it[x].filepath }}" onerror="APIUtils.noFind()"
             width="90%" onclick="APIUtils.openPhotoBrowser(null, '{{=x}}', this.name)"/>
        <div class="tc">{{? it[x].oldname != null }} {{= it[x].oldname}}{{??}} {{= it[x].filename}} {{?}}</div>
    </li>
    {{ } }}
</script>
<script type="text/javascript">
    apiready = function() {
        $api.fixStatusBar( $api.dom('header'));
        var pageParam = api.pageParam;
        initDeciceDetail(pageParam.id);
        initDeviceImg(pageParam.id);
    };

    //加载工地详细信息
    function initDeciceDetail(id){
        APIUtils.showProgress("提示", "正在加载中....");
        superModule.getDeviceDetail(id, function(ret, err) {
            APIUtils.hideProgress();
            // 判断请求是否错误
            if (!APIUtils.errorCatch(err)) {
                return;
            }
            var data = ret.object;
            // 设置dom元素内容
            // 设备名称
            $api.dom('#deviceName').innerHTML = data.deviceName == null ? "" : data.deviceName.replace(/<.*?>/g,"");
            //设备类型
            $api.dom('#deviceSubTypeText').innerHTML = data.deviceSubTypeText == null ? "" : data.deviceSubTypeText.replace(/<.*?>/g,"");
            //机械区域
            $api.dom('#position').innerHTML = data.position == null ? "" : data.position.replace(/<.*?>/g,"");
            //备案机关
            $api.dom('#openApi').innerHTML = data.openApi == null ? "" : data.openApi.replace(/<.*?>/g,"");
            //制造单位
            $api.dom('#manufacturer').innerHTML = data.manufacturer == null ? "" : data.manufacturer.replace(/<.*?>/g,"");
            //备案时间
            $api.dom('#entryTime').innerHTML = data.entryTime == null ? "" : new Date(data.entryTime).Format("yyyy-MM-dd");
            //合格证编号
            $api.dom('#f1').innerHTML = data.f1 == null ? "" : data.f1.replace(/<.*?>/g,"");
            //所属项目编号
            $api.dom('#f2').innerHTML = data.f2 == null ? "" : data.f2.replace(/<.*?>/g,"");
            //生产日期
            $api.dom('#createOn').innerHTML = data.createOn == null ? "" : new Date(data.createOn).Format("yyyy-MM-dd");
            //规格型号
            $api.dom('#deviceKind').innerHTML = data.deviceKind == null ? "" : data.deviceKind.replace(/<.*?>/g,"");
            //购置日期
            $api.dom('#updateOn').innerHTML = data.updateOn == null ? "" : new Date(data.updateOn).Format("yyyy-MM-dd");
            //所属项目名称
            $api.dom('#projectName').innerHTML = data.projectName == null ? "" : data.projectName.replace(/<.*?>/g,"");
            //使用年限
            $api.dom('#orderby').innerHTML = data.orderby == null ? "" : data.orderby;
            //状态
            $api.dom('#state').innerHTML = data.state == null ? "" : data.state.replace(/<.*?>/g,"");
            // 设备产权单位
            $api.dom('#leasingCompany').innerHTML = data.leasingCompany == null ? "" : data.leasingCompany.replace(/<.*?>/g,"");
            //单位地址
            $api.dom('#memo').innerHTML = data.memo == null ? "" : data.memo.replace(/<.*?>/g,"");
            //企业代表
            $api.dom('#leasingContact').innerHTML = data.leasingContact == null ? "" : data.leasingContact.replace(/<.*?>/g,"");
            //法人电话
            $api.dom('#leasingPhone').innerHTML = data.leasingPhone == null ? "" : data.leasingPhone.replace(/<.*?>/g,"");
            //联系人
            $api.dom('#responsiblePersonName').innerHTML = data.responsiblePersonName == null ? "" : data.responsiblePersonName.replace(/<.*?>/g,"");
            //联系电话
            $api.dom('#responsiblePersonPhone').innerHTML = data.responsiblePersonPhone == null ? "" : data.responsiblePersonPhone.replace(/<.*?>/g,"");
        });
    }

    // 加载附件信息
    function initDeviceImg(id) {
        APIUtils.showProgress("提示", "正在加载中....");
        var deviceImgData = {businessid: id, associationtype: "1"};
        superModule.getDeviceDetailImg(deviceImgData, function(ret, err) {
            APIUtils.hideProgress();
            // 判断请求是否错误
            if (!APIUtils.errorCatch(err)) {
                return;
            }
            var data = ret.data;
            // 去除文件后缀名
            for(var i=0; i<data.length; i++) {
                data[i].filepath = SYS_CONF.FILEDOMAIN + data[i].filepath;
                data[i].oldname = data[i].oldname.substring(0, data[i].oldname.indexOf("."));
                data[i].filename = data[i].filename.substring(0, data[i].filename.indexOf("."));
            }
            // 设置dom元素内容
            var interText = doT.template($api.dom("#imgDot").innerHTML);
            $api.dom('#imgDiv').innerHTML = interText(data);
            $api.append($api.dom('#imgDiv'),"<div class='clear'></div>");
        });
    }
</script>
</body>

</html>