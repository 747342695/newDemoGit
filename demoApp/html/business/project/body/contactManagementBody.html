<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>通讯录管理</title>
    <link href="../../../../css/mui.css" rel="stylesheet" />
    <link href="../../../../css/layout.css" rel="stylesheet" />
    <link href="../../../../css/contactManagement.css" rel="stylesheet" />
</head>

<body>
<header class="mui-bar-nav mui-bar-transparent" style="display: none">
    <a class="mui-icon mui-icon-left-nav mui-pull-left" onclick="APIUtils.goBeforePage()"></a>
    <h1 class="mui-title">通讯录管理</h1>
</header>
<div style="height:10px;"></div>
<div class="mui-col-sm-8 mui-col-xs-8 fl">
    <div class="mui-input-row mui-search">
        <div type="search" onclick="searchContact()"><span class="mui-icon mui-icon-search"></span><span id="searchContent">搜索</span></div>
    </div>
</div>
<div class="mui-col-sm-4 mui-col-xs-4 fl mb15">
    <button class="searchBtn" value="查看全部" onclick="clickLoad()">查看全部</button>
</div>

<div class="dubellinelist">
    <ul id="contactDiv" style="padding-bottom: 42px;">
        <li id="contactLi" style="visibility: hidden">
            <div class="mui-col-sm-1 mui-col-xs-1 fl tc lineHeight44">
                1
            </div>
            <div class="mui-col-sm-11 mui-col-xs-11 fl">
                无
                <p>编号:</p>
            </div>
            <div class="clear"></div>
            <div class="mui-row borderDiv">
                <div class="inforTittle"><span>建设单位信息</span> <div class="clear"></div></div>
                <div class="mui-col-sm-4 mui-col-xs-4 fl lineHeight28">单位名称:</div>
                <div class="mui-col-sm-8 mui-col-xs-8 fl lineHeight28 colorWhite">&nbsp;</div>
                <div class="mui-col-sm-4 mui-col-xs-4 fl lineHeight28">负责人:</div>
                <div class="mui-col-sm-8 mui-col-xs-8 fl lineHeight28 colorWhite">&nbsp;</div>
                <div class="mui-col-sm-4 mui-col-xs-4 fl lineHeight28">电话:</div>
                <div class="mui-col-sm-8 mui-col-xs-8 fl lineHeight28 colorWhite">&nbsp;</div>
                <div class="clear"></div>
            </div>
            <div class="mui-row borderDiv">
                <div class="inforTittle"><span>设计单位信息</span> <div class="clear"></div></div>
                <div class="mui-col-sm-4 mui-col-xs-4 fl lineHeight28">单位名称:</div>
                <div class="mui-col-sm-8 mui-col-xs-8 fl lineHeight28 colorWhite">&nbsp;</div>
                <div class="mui-col-sm-4 mui-col-xs-4 fl lineHeight28">负责人:</div>
                <div class="mui-col-sm-8 mui-col-xs-8 fl lineHeight28 colorWhite">&nbsp;</div>
                <div class="mui-col-sm-4 mui-col-xs-4 fl lineHeight28">电话:</div>
                <div class="mui-col-sm-8 mui-col-xs-8 fl lineHeight28 colorWhite">&nbsp;</div>
                <div class="clear"></div>
            </div>
            <div class="mui-row borderDiv">
                <div class="inforTittle"><span>施工单位信息</span> <div class="clear"></div></div>
                <div class="mui-col-sm-4 mui-col-xs-4 fl lineHeight28">单位名称:</div>
                <div class="mui-col-sm-8 mui-col-xs-8 fl lineHeight28 colorWhite">&nbsp;</div>
                <div class="mui-col-sm-4 mui-col-xs-4 fl lineHeight28">负责人:</div>
                <div class="mui-col-sm-8 mui-col-xs-8 fl lineHeight28 colorWhite">&nbsp;</div>
                <div class="mui-col-sm-4 mui-col-xs-4 fl lineHeight28">电话:</div>
                <div class="mui-col-sm-8 mui-col-xs-8 fl lineHeight28 colorWhite">&nbsp;</div>
                <div class="clear"></div>
            </div>
            <div class="mui-row borderDiv">
                <div class="inforTittle"><span>监理单位信息</span> <div class="clear"></div></div>
                <div class="mui-col-sm-4 mui-col-xs-4 fl lineHeight28">单位名称:</div>
                <div class="mui-col-sm-8 mui-col-xs-8 fl lineHeight28 colorWhite">&nbsp;</div>
                <div class="mui-col-sm-4 mui-col-xs-4 fl lineHeight28">负责人:</div>
                <div class="mui-col-sm-8 mui-col-xs-8 fl lineHeight28 colorWhite">&nbsp;</div>
                <div class="mui-col-sm-4 mui-col-xs-4 fl lineHeight28">电话:</div>
                <div class="mui-col-sm-8 mui-col-xs-8 fl lineHeight28 colorWhite">&nbsp;</div>
                <div class="clear"></div>
            </div>
            <div class="mui-row borderDiv">
                <div class="inforTittle"><span>勘察单位信息</span> <div class="clear"></div></div>
                <div class="mui-col-sm-4 mui-col-xs-4 fl lineHeight28">单位名称:</div>
                <div class="mui-col-sm-8 mui-col-xs-8 fl lineHeight28 colorWhite">&nbsp;</div>
                <div class="mui-col-sm-4 mui-col-xs-4 fl lineHeight28">负责人:</div>
                <div class="mui-col-sm-8 mui-col-xs-8 fl lineHeight28 colorWhite">&nbsp;</div>
                <div class="mui-col-sm-4 mui-col-xs-4 fl lineHeight28">电话:</div>
                <div class="mui-col-sm-8 mui-col-xs-8 fl lineHeight28 colorWhite">&nbsp;</div>
                <div class="clear"></div>
            </div>
        </li>
    </ul>
</div>
<script id="contactDot" type="text/x-dot-template">
    {{ for(var x in it) { }}
    <li>
        <div class="mui-col-sm-1 mui-col-xs-1 fl tc lineHeight44">
            {{= it[x].No}}
        </div>
        <div class="mui-col-sm-11 mui-col-xs-11 fl">
            {{= it[x].name}}
            <p>编号:{{= it[x].projectCode}}</p>
        </div>
        <div class="clear"></div>
        <div class="mui-row borderDiv">
            <div class="inforTittle"><span>建设单位信息</span> <div class="clear"></div></div>
            <div class="mui-col-sm-4 mui-col-xs-4 fl lineHeight28">单位名称:</div>
            <div class="mui-col-sm-8 mui-col-xs-8 fl lineHeight28 colorWhite">{{? it[x].developmentUnit != null }} {{= it[x].developmentUnit}} {{??}} &nbsp; {{?}}</div>
            <div class="mui-col-sm-4 mui-col-xs-4 fl lineHeight28">负责人:</div>
            <div class="mui-col-sm-8 mui-col-xs-8 fl lineHeight28 colorWhite">{{? it[x].developmentUnitStaffName != null }} {{= it[x].developmentUnitStaffName}} {{??}} &nbsp; {{?}}</div>
            <div class="mui-col-sm-4 mui-col-xs-4 fl lineHeight28">电话:</div>
            <div class="mui-col-sm-8 mui-col-xs-8 fl lineHeight28 colorWhite">{{? it[x].developmentUnitStaffPhone != null }} {{= it[x].developmentUnitStaffPhone}} {{??}} &nbsp; {{?}}</div>
            <div class="clear"></div>
        </div>
        <div class="mui-row borderDiv">
            <div class="inforTittle"><span>设计单位信息</span> <div class="clear"></div></div>
            <div class="mui-col-sm-4 mui-col-xs-4 fl lineHeight28">单位名称:</div>
            <div class="mui-col-sm-8 mui-col-xs-8 fl lineHeight28 colorWhite">{{? it[x].designUnit != null }} {{= it[x].designUnit}} {{??}} &nbsp; {{?}}</div>
            <div class="mui-col-sm-4 mui-col-xs-4 fl lineHeight28">负责人:</div>
            <div class="mui-col-sm-8 mui-col-xs-8 fl lineHeight28 colorWhite">{{? it[x].designUnitStaffName != null }} {{= it[x].designUnitStaffName}} {{??}} &nbsp; {{?}}</div>
            <div class="mui-col-sm-4 mui-col-xs-4 fl lineHeight28">电话:</div>
            <div class="mui-col-sm-8 mui-col-xs-8 fl lineHeight28 colorWhite">{{? it[x].designUnitStaffPhone != null }} {{= it[x].designUnitStaffPhone}} {{??}} &nbsp; {{?}}</div>
            <div class="clear"></div>
        </div>
        <div class="mui-row borderDiv">
            <div class="inforTittle"><span>施工单位信息</span> <div class="clear"></div></div>
            <div class="mui-col-sm-4 mui-col-xs-4 fl lineHeight28">单位名称:</div>
            <div class="mui-col-sm-8 mui-col-xs-8 fl lineHeight28 colorWhite">{{? it[x].constructionUnit != null }} {{= it[x].constructionUnit}} {{??}} &nbsp; {{?}}</div>
            <div class="mui-col-sm-4 mui-col-xs-4 fl lineHeight28">负责人:</div>
            <div class="mui-col-sm-8 mui-col-xs-8 fl lineHeight28 colorWhite">{{? it[x].constructionUnitStaffName != null }} {{= it[x].constructionUnitStaffName}} {{??}} &nbsp; {{?}}</div>
            <div class="mui-col-sm-4 mui-col-xs-4 fl lineHeight28">电话:</div>
            <div class="mui-col-sm-8 mui-col-xs-8 fl lineHeight28 colorWhite">{{? it[x].constructionUnitStaffPhone != null }} {{= it[x].constructionUnitStaffPhone}} {{??}} &nbsp; {{?}}</div>
            <div class="clear"></div>
        </div>
        <div class="mui-row borderDiv">
            <div class="inforTittle"><span>监理单位信息</span> <div class="clear"></div></div>
            <div class="mui-col-sm-4 mui-col-xs-4 fl lineHeight28">单位名称:</div>
            <div class="mui-col-sm-8 mui-col-xs-8 fl lineHeight28 colorWhite">{{? it[x].supervisor != null }} {{= it[x].supervisor}} {{??}} &nbsp; {{?}}</div>
            <div class="mui-col-sm-4 mui-col-xs-4 fl lineHeight28">负责人:</div>
            <div class="mui-col-sm-8 mui-col-xs-8 fl lineHeight28 colorWhite">{{? it[x].supervisorStaffName != null }} {{= it[x].supervisorStaffName}} {{??}} &nbsp; {{?}}</div>
            <div class="mui-col-sm-4 mui-col-xs-4 fl lineHeight28">电话:</div>
            <div class="mui-col-sm-8 mui-col-xs-8 fl lineHeight28 colorWhite">{{? it[x].supervisorStaffPhone != null }} {{= it[x].supervisorStaffPhone}} {{??}} &nbsp; {{?}}</div>
            <div class="clear"></div>
        </div>
        <div class="mui-row borderDiv">
            <div class="inforTittle"><span>勘察单位信息</span> <div class="clear"></div></div>
            <div class="mui-col-sm-4 mui-col-xs-4 fl lineHeight28">单位名称:</div>
            <div class="mui-col-sm-8 mui-col-xs-8 fl lineHeight28 colorWhite">{{? it[x].investor != null }} {{= it[x].investor}} {{??}} &nbsp; {{?}}</div>
            <div class="mui-col-sm-4 mui-col-xs-4 fl lineHeight28">负责人:</div>
            <div class="mui-col-sm-8 mui-col-xs-8 fl lineHeight28 colorWhite">{{? it[x].investorStaffName != null }} {{= it[x].investorStaffName}} {{??}} &nbsp; {{?}}</div>
            <div class="mui-col-sm-4 mui-col-xs-4 fl lineHeight28">电话:</div>
            <div class="mui-col-sm-8 mui-col-xs-8 fl lineHeight28 colorWhite">{{? it[x].investorStaffPhone != null }} {{= it[x].investorStaffPhone}} {{??}} &nbsp; {{?}}</div>
            <div class="clear"></div>
        </div>
    </li>
    {{ } }}
</script>
<script type="text/javascript" src="../../../../script/dot.min.js"></script>
<script type="text/javascript" src="../../../../script/api.js"></script>
<script type="text/javascript" src="../../../../script/js/APIUtils.js"></script>
<script type="text/javascript" src="../../../../script/js/business/business-project.js"></script>
<script type="text/javascript">
    // 数据加载参数（页码大小、页码起始页、搜索条件）
    var searchDataJson = {pageSize: 0, pageIndex: 0, searchData: [{}]};
    // 搜索参数
    var searchData = {projectName: "", projectId: "", projectCode: ""};

    apiready = function() {
        $api.fixStatusBar( $api.dom('header'));
        searchDataJson.pageSize = APIUtils.getPageSize(null, "contactLi");
        // 初始监听事件
        fnInitEvent();
        // 初始加载分页数据
        loadContact();
    };

    /**
     * 搜索框设置查询条件
     */
    function setSearch(str) {
        searchData = str;
        // 设置数据加载参数
        var searchJsonArr = new Array();
        searchJsonArr.push({"name":"eq_id", "value": searchData.projectId});
        searchJsonArr.push({"name":"like_projectCode", "value": searchData.projectCode});
        searchDataJson.searchData = searchJsonArr;
        // 清空之前条件查询的数据内容
        $api.dom('#contactDiv').innerHTML = "";
        // 根据搜索条件重新搜索
        searchDataJson.pageIndex = 0;
        // 根据搜索条件刷新数据
        loadContact();
    }
    /**
     * 跳转通讯录搜索frame框，输入查询通讯录条件
     */
    function searchContact() {
        APIUtils.goToSearch('contactSearchForm', '../search/contactSearchForm.html', searchData);
    }
    /**
     * 触发查询全部按钮
     */
    function clickLoad() {
        // 清空搜索参数数据
        searchData = {projectName: "", projectId: "", projectCode: ""};
        // 清空查询条件
        searchDataJson.searchData = [{}];
        // 清空之前条件查询的数据内容
        $api.dom('#contactDiv').innerHTML = "";
        // 根据搜索条件重新搜索
        searchDataJson.pageIndex = 0;
        // 根据搜索条件刷新数据
        loadContact();
    }
    /**
     * 加载通讯录数据
     */
    function loadContact(isStart){
        APIUtils.showProgress("提示", "正在加载中....");
        projectModule.getProject(searchDataJson, function(ret, err) {
            APIUtils.hideProgress();
            // 判断请求是否错误
            if (!APIUtils.errorCatch(err)) {
                return;
            }
            var contactData = ret.data;
            if(contactData==null || contactData.length==0) {
                APIUtils.showToast("无更多数据加载",1000);
                return;
            }
            // 设置dom元素序号内容
            var no = searchDataJson.pageIndex*searchDataJson.pageSize+1;
            for (var i = 0; i < contactData.length; i++) {
                contactData[i].No = no+i;
            }
            // 数据页码加一
            searchDataJson.pageIndex++;
            var interText = doT.template($api.dom("#contactDot").innerHTML);
            if(isStart == false) {
                $api.append($api.dom('#contactDiv'),interText(contactData));
            } else {
                $api.dom('#contactDiv').innerHTML = interText(contactData);
            }
        });
    }
    /**
     * 初始化页面监听事件
     */
    function fnInitEvent(){
        /**上拉加载 */
        api.addEventListener({
            name:'scrolltobottom',
            extra:{
                threshold:10
            }
        }, function(ret, err){
            // 继续请求数据
            loadContact(false);
        });
        /** 下拉刷新 */
        api.setRefreshHeaderInfo({
            bgColor: '#ccc',
            textColor: '#fff',
            textDown: '下拉刷新...',
            textUp: '松开刷新...'
        }, function(ret, err) {
            searchDataJson.pageIndex = 0;
            // 刷新数据
            loadContact();
            // 取消下拉刷新效果
            api.refreshHeaderLoadDone();
        });
    }
</script>
</body>
</html>