<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <title>项目-历史天气</title>
    <link href="../../../../css/mui.css" rel="stylesheet"/>
    <link href="../../../../css/layout.css" rel="stylesheet"/>
    <!--<link href="../../../../css/envDetail.css" rel="stylesheet"/>-->
</head>

<body>
<!--<header class="mui-bar-nav mui-bar-transparent" id="topbar">-->
<!--<a class="mui-icon mui-icon-left-nav mui-pull-left" onclick="APIUtils.goBeforePage()"></a>-->
<!--<h1 class="mui-title">历史天气</h1>-->
<!--</header>-->
<!--<div style="height:44px;"></div>-->
<div class="dubellinelist bgblue" id="result">
    <ul id="ulList" >

    </ul>
</div>

<div class="tc" style="margin-bottom:42px ">
    <p class="f20 lineHeight44 mt10">仅显示过去7天天气信息</p>
    <p class="f15 fblue2">更多天气信息请登录PC端查看</p>
</div>
<script id="weatherTemplate" type="text/x-dot-template">
    {{ for(var x in it) { }}
    <li>
        <div class="mui-col-sm-3 mui-col-xs-3 fl tc lineHeight34">
            {{= new Date(it[x].date).Format("yyyy-MM-dd")}}
        </div>
        <div class="mui-col-sm-3 mui-col-xs-3 fl tc lineHeight34">
            {{= it[x].templow}}~{{= it[x].temphigh}}度
        </div>
        <div class="mui-col-sm-3 mui-col-xs-3 fl tc lineHeight34">
            {{= it[x].windspeed.substr(0,4)}}
        </div>
        <div class="mui-col-sm-3 mui-col-xs-3 fl tc lineHeight34">
            {{= it[x].weather}}
        </div>

        <div class="clear"></div>
    </li>
    {{ } }}
</script>
<script src="../../../../script/api.js"></script>
<script src="../../../../script/dot.min.js" type="text/javascript"></script>
<script src="../../../../script/js/APIUtils.js"></script>
<script src="../../../../script/js/business/business-env.js"></script>
<script>
    var pageQueryDto = {pageIndex: 0, pageSize: 10, searchData: [], sortField: "date", sortOrder: "asc",};
    apiready = function () {
        // 查询最近7天的天气
        // 获取今天
        pageQueryDto.searchData.push({name: 'eq_projectId', value: api.pageParam.projectId});
        pageQueryDto.searchData.push({name: 'ged_date', value: new Date(new Date().getTime() - 144*60*60*1000).Format("yyyy-MM-dd") });
        pageQueryDto.searchData.push({name: 'led_date', value: new Date().Format("yyyy-MM-dd")});
        queryBeforeWeekWeather();
    };

    function queryBeforeWeekWeather() {
        APIUtils.showProgress('提示', '正在加载中');
        envModule.queryBeforeWeekWeather(pageQueryDto, function (ret, err) {
            APIUtils.hideProgress();
            if (!APIUtils.errorCatch(err)) {
                $api.dom('#ulList').innerHTML = "";
                return;
            }
            if (ret["data"] == null || ret["data"].length == 0) {
                $api.dom('#result').innerHTML = " <p class=\"f20 lineHeight44 mt10\" align='center'>暂无七天的数据</p>";
                return;
            }
            var evaluation = doT.template($api.dom("#weatherTemplate").innerHTML);
            $api.dom('#ulList').innerHTML = evaluation(ret.data);
        });
    }

</script>
</body>

</html>